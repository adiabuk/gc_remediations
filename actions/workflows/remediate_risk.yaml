version: 1.0
description: remediate risk factor

input:
  - down_device

tasks:
  check_risk:
    action: gc_risk_factor.check_risk down_device=<% ctx(down_device) %>
  next:
    - when: <% failed() %>
      do: drain_prod
      publish:
        - stdout: <% result().stdout %>
        - stderr: <% result().stderr %>
    - when: <% succeeded() %>
      do: undrain_prod
      publish:
        - stdout: <% result().stdout %>
        - stderr: <% result().stderr %>
  drain_prod:
    action :gc_risk_factor.drain_prod down_device=<% ctx(down_device) %>
  undrain_prod:
    action :gc_risk_factor.undrain_prod down_device=<% ctx(down_device) %>
